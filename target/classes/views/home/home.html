<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <link rel="stylesheet" href="../base/css/element.css" />
    <link rel="stylesheet" href="../home/css/home.css"/>
    <title>主页</title>
</head>
<body>

<div id="main-home" class="main-home-div">
    <el-container>
        <el-header>
            <el-row>
                <el-col :span="4">
                    <div class="main-home-log">
                    </div>
                </el-col>
                <el-col :span="16">
                    <div>
                        <span>今天是：2020年04月25日，欢迎来到我的世界</span>
                    </div>
                </el-col>

                <el-col :span="1">
                    <div class="icon-el">
                        <el-tooltip class="item" effect="light" content="我的任务" placement="top-start">
                            <i class="el-icon-message-solid"></i>
                            <!-- 其他工具栏区域 -->
                        </el-tooltip>
                    </div>
                </el-col>
                <el-col :span="1">
                    <div class="icon-el">
                        <el-tooltip class="item" effect="light" content="我的信息" placement="top-start">
                            <i class="el-icon-user-solid"></i>
                            <!-- 其他工具栏区域 -->
                        </el-tooltip>
                    </div>
                </el-col>
                <el-col :span="1">
                    <div class="icon-el">
                        <el-tooltip class="item" effect="light" content="设置" placement="top-start">
                            <i class="el-icon-s-tools"></i>
                        <!-- 其他工具栏区域 -->
                        </el-tooltip>
                    </div>
                </el-col>

                <el-col :span="1">
                    <div class="icon-el">
                        <el-tooltip class="item" effect="light" content="安全退出" placement="top-start">
                            <i class="el-icon-remove"></i>
                            <!-- 其他工具栏区域 -->
                        </el-tooltip>
                    </div>
                </el-col>

            </el-row>

        </el-header>
        <el-container>
            <el-aside width="200px">
                <el-scrollbar
                        class="default-scrollbar"
                        wrap-class="default-scrollbar__wrap"
                        view-class="default-scrollbar__view">
                    <!-- 左侧菜单栏 -->
                    <el-col :span="24" class="meun-div">
                        <el-menu  class="el-menu-vertical"
                                 default-active=""
                                 :unique-opened="true"
                                 text-color="#fff">



                            <!-- 循环一级菜单，如果一级菜单没有子菜单，即自己就可以点击-->
                            <el-menu-item
                                    th:each="resource,index: ${menu}"
                                    style="background-color:#7f7f7f"
                                    th:if="${resource.resourceInfoList eq null}"
                                    th:attr="index=${(index.index+1)}">
                                <span slot="title"
                                      style="font-weight: bold"
                                      th:text="${resource.resourceName}"></span>
                            </el-menu-item>
                            <!-- 循环一级菜单，如果一级菜单有子菜单，即自己打开-->
                            <el-submenu
                                    style="background-color:#7f7f7f"
                                    th:each="resource,index: ${menu}"
                                    th:if="${resource.resourceInfoList ne null}"
                                    th:attr="index=${(index.index+1)}">
                                <template slot="title">
                                    <span style="font-weight: bold" th:text="${resource.resourceName}"></span>
                                </template>
                                <!-- 循环二级菜单，二级菜单没有子菜单，即自己就可以点击-->
                                <el-menu-item
                                        th:each="child,cindex:${resource.resourceInfoList}"
                                        th:if="${child.resourceInfoList eq null}"
                                        style="background-color:#9f9f9f"
                                        th:attr="index=${(index.index+1)+'-'+(cindex.index+1)}"
                                        th:text="${child.resourceName}">
                                </el-menu-item>

                                <!-- 循环二级菜单，二级菜单有子菜单，即自己展开-->
                                <el-submenu
                                        th:each="child,cindex:${resource.resourceInfoList}"
                                        style="background-color:#9f9f9f"
                                        th:if="${child.resourceInfoList ne null}"
                                        th:attr="index=${(index.index+1)+'-'+(cindex.index+1)}">
                                    <template slot="title" style="font-weight: bold;" th:text="${child.resourceName}"></template>
                                    <!-- 循环三级菜单，三级菜单没有子菜单，即自己就可以点击-->
                                    <el-menu-item
                                            style="background-color:rgb(197, 197, 197)"
                                            th:each="cchild,ccindex:${child.resourceInfoList}"
                                            th:attr="index=${(index.index+1)+'-'+(cindex.index+1)+'-'+(ccindex.index+1)}"
                                            th:text="${cchild.resourceName}">
                                    </el-menu-item>
                                    <!-- 目前只支持到三级菜单，如果有需要，可以在这里继续循环-->
                                </el-submenu>
                            </el-submenu>



























<!--                            &lt;!&ndash; 首页菜单 &ndash;&gt;-->
<!--                            <el-menu-item index="1-3" class="first-init-page" background-color="#d4d4d5">首页</el-menu-item>-->




<!--                            &lt;!&ndash;循环用户资源菜单&ndash;&gt;-->
<!--                            <el-menu background-color="#8d8d8d" th:each="resource,index: ${menu}">-->
<!--                                &lt;!&ndash; 一级菜单 &ndash;&gt;-->
<!--                                <el-submenu index="${index+1}">-->
<!--                                    &lt;!&ndash; template不支持tips显示，所以控制包含子集菜单的菜单名字不要太长，否则不好看 &ndash;&gt;-->
<!--                                    <template slot="title">-->
<!--                                        <span slot="title" style="font-weight:bold;font-size: 14px"-->
<!--                                              th:text="${resource.resourceName}"></span>-->
<!--                                    </template>-->
<!--                                    &lt;!&ndash; 二级菜单 &ndash;&gt;-->
<!--                                    <el-menu background-color="#a3a3a3" th:each="childRes,cIndex:${resource.resourceInfoList}">-->

<!--                                        &lt;!&ndash;二级菜单没有子菜单的情况，即自己可以点击，添加点击事件 &ndash;&gt;-->
<!--                                        &lt;!&ndash;名字不超过10个字符 ${childRes.resourcePath} &ndash;&gt;-->
<!--                                        <el-menu-item index="${index+1}-${cIndex+1}" v-on:click="openMenuUrl($event)" th:attr="param=${childRes.resourcePath}"-->
<!--                                                      th:if="${(childRes.resourceInfoList eq null or childRes.resourceInfoList.size() eq 0) and childRes.resourceName.length() le 10}"-->
<!--                                                      th:text="${childRes.resourceName}">-->
<!--                                        </el-menu-item>-->
<!--                                        &lt;!&ndash;名字不超过10个字符，加个tips &ndash;&gt;-->
<!--                                        <el-tooltip class="item" effect="light"-->
<!--                                                    th:if="${(childRes.resourceInfoList eq null or childRes.resourceInfoList.size() eq 0) and childRes.resourceName.length() gt 10}"-->
<!--                                                    th:attr="content=${childRes.resourceName}" content="" placement="top-start">-->
<!--                                            <el-menu-item index="${index+1}-${cIndex+1}" v-on:click="openMenuUrl"-->
<!--                                                          th:text="${#strings.substring(childRes.resourceName,0,10)+'...'}">-->
<!--                                            </el-menu-item>-->
<!--                                        </el-tooltip>-->

<!--                                        &lt;!&ndash;二级菜单有子菜单的情况，即需要展开下一级 &ndash;&gt;-->
<!--                                        <el-submenu index="${index+1}-${cIndex+1}" th:if="${childRes.resourceInfoList ne null and childRes.resourceInfoList.size() gt 0}">-->
<!--                                            <template slot="title">-->
<!--                                                <span slot="title" th:text="${childRes.resourceName}"></span>-->
<!--                                            </template>-->
<!--                                            &lt;!&ndash; 三级菜单,目前仅支持三级，如需要扩展，继续按照上面方式扩展即可 &ndash;&gt;-->
<!--                                            <el-menu background-color="#c6c6c6" th:each="ccsRes,ccIndex:${childRes.resourceInfoList}">-->


<!--                                                <el-menu-item index="1-1-1" v-on:click="openMenuUrl"-->
<!--                                                              th:if="${ccsRes.resourceName.length() le 10}"-->
<!--                                                              th:attr="param=${ccsRes.resourcePath}"-->
<!--                                                              th:text="${ccsRes.resourceName}"></el-menu-item>-->
<!--                                                <el-tooltip class="item" effect="light"-->
<!--                                                            th:if="${ccsRes.resourceName.length() gt 10}"-->
<!--                                                            th:attr="content=${ccsRes.resourceName}" content="" placement="top-start">-->
<!--                                                    <el-menu-item index="1-1-1" v-on:click="openMenuUrl"-->
<!--                                                                  th:attr="param=${ccsRes.resourcePath}"-->
<!--                                                                  th:text="${#strings.substring(ccsRes.resourceName,0,10)+'...'}"></el-menu-item>-->
<!--                                                </el-tooltip>-->
<!--                                            </el-menu>-->
<!--                                        </el-submenu>-->
<!--                                    </el-menu>-->
<!--                                </el-submenu>-->
<!--                            </el-menu>-->





                        </el-menu>
                    </el-col>
                </el-scrollbar>
            </el-aside>

            <el-main>
                <!--点击菜单返回页面区域  -->
                <el-tabs v-model="editableTabsValue" type="card" closable @tab-remove="removeTab" @tab-click="leftClickTab" class="tab-page">
                    <el-tab-pane
                            v-for="(item) in editableTabs"
                            :key="item.url"
                            :label="item.title"
                            :name="item.url"
                    >
                        <iframe :src="item.url" style="height: 100%;width: 100%;border: 0px"></iframe>
                    </el-tab-pane>
                </el-tabs>
            </el-main>

        </el-container>
    </el-container>
</div>

</body>
<script type="text/javascript" src="../base/js/jquery.min.js"></script>
<script type="text/javascript" src="../base/js/vue.min.js"></script>
<script type="text/javascript" src="../base/js/element.js"></script>
<script type="text/javascript" src="../base/js/common.js"></script>
<script type="text/javascript" src="../home/js/home.js"></script>
<script>
    new Vue({
        el: '#main-home',
        data: function() {
            return {
                editableTabsValue: 'MAIN-INDEX',
                editableTabs: [{
                    title: '首页',
                    name: 'MAIN-INDEX',
                    url: 'MAIN-INDEX',
                }]
            }
        },
        methods: {
            //打开资源菜单
            openMenuUrl(e) {
                /*打开资源菜单*/
                //当前菜单url
                let meunUrl = $(e.$el).attr('param');
                this.addTab($(e.$el).html(),meunUrl);
                /*当前菜单添加样式，其他菜单取消样式--由于菜单样式结构非原生ElementUI结构，所以这里需要做些js变化*/
                $(e.$el).addClass('is-active');
                //循环其他菜单
                let lis = $(".meun-div").find('li');
                $.each(lis,function(thisLi){
                    console.log(lis[thisLi]);
                    let thisLiUrl = $(lis[thisLi]).attr('param');
                    if(thisLiUrl != meunUrl){
                        //取消选中样式
                        $(lis[thisLi]).removeClass('is-active');
                    }
                });
            },
            //添加tab
            addTab(targetName,tabSrc) {
                if($.isNullString(targetName) || $.isNullString(tabSrc)){
                    return;
                }
                //先判断是否已经打开过了，打开过则直接打开，否则新增一个tab
                let isExist = false;
                $.each(this.editableTabs,function(thisTabIndex,thisObj){
                    let openSourceUrl = thisObj.url;
                    if(openSourceUrl == tabSrc){
                        //已经存在
                        isExist = true;
                        return;
                    }
                });
                if(isExist){
                    //已经存在，打开存在的tab
                    this.editableTabsValue = tabSrc;
                    return;
                }
                this.editableTabs.push({
                    title: targetName,
                    name: tabSrc,
                    url: tabSrc
                });
                this.editableTabsValue = tabSrc;
            },
            //左键单击tab
            leftClickTab(thisTab){
                //当前tab实例
                console.log(thisTab);
                //左侧菜单栏，需要选中
                //todo
            },
            //移除tab
            removeTab(targetName) {
                let tabs = this.editableTabs;
                let activeName = this.editableTabsValue;
                if (activeName === targetName) {
                    tabs.forEach((tab, index) => {
                        if (tab.name === targetName) {
                            let nextTab = tabs[index + 1] || tabs[index - 1];
                            if (nextTab) {
                                activeName = nextTab.name;
                            }
                        }
                    });
                }
                this.editableTabsValue = activeName;
                this.editableTabs = tabs.filter(tab => tab.name !== targetName);
            }
        }
    });

</script>
</html>